<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="initial-scale=1.0, user-scalable=yes" />
        <title>onestaufond.fr</title>
        <link rel="stylesheet" type="text/css" href="/statics/css/wr-easy.css">
        <link rel="stylesheet" type="text/css" href="/statics/css/color.css">
        <link rel="stylesheet" type="text/css" href="/statics/css/style.css">
    </head>
    <body class="bg-b">

        <header class="wr pad10 bg-bd5 cl-bl5 dib1">
            <img class="wr vam mh32 mw32 mrgr5" src="statics/img/commons/refresh.svg" title="rafraichissement"><p class="wr w80 f15 lg-f20 vam">Rafraichissement des données toutes les 30 minutes</p>
        </header>

        <section class="wr lg-c80 mrgt10 bg-bl2">
            <h1 class="wr pad9 bg-bd6 cl-bl5 dib1">
                <div class="wr w70 sm-f12">
                    <img class="wr vam" src="statics/img/commons/server.png" title="serveur">&nbsp;Serveur
                </div><!--
             --><p id="timer_server" class="wr w30 txr sm-dn">00:00:00</p>
            </h1>
            <div class="wr dib1">
                <div class="wr w30 vam txc"><img id="status_server" class="wr mh64" src="statics/img/commons/off.svg"></div><!--
             --><div class="wr w70 vam">
                    <br>
                    <article>
                        <h2><img class="wr vam" src="statics/img/commons/cpu.png" title="cpu">&nbsp;Processus</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p  id="cpu_server" class="wr txc vam">0%</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div id="cpu_server_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div>
                        </div>
                    </article>
                    <article>
                        <h2><img class="wr vam" src="statics/img/commons/memory.png" title="memoire">&nbsp;Mémoire</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p id="mem_server" class="wr txc vam">0%</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div id="mem_server_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div>
                        </div>
                    </article>
                    <br>
                </div>
            </div>
        </section>

        <section class="wr lg-c80 mrgt10 bg-bl2">
            <h1 class="wr pad9 bg-bd6 cl-bl5 dib1">
                <div class="wr w70 sm-f12">
                    <img class="wr vam mw32" src="statics/img/logo.png" title="onestaufond">&nbsp;onestaufond.fr
                </div><!--
             --><p id="timer_onestaufond" class="wr w30 txr sm-dn">00:00:00</p>
            </h1>
            <div class="wr dib1">
                <div class="wr w30 vam txc"><img id="status_onestaufond" class="wr mh64" src="statics/img/commons/off.svg"></div><!--
             --><div class="wr w70 vam">
                    <br>
                    <article>
                        <h2><img class="wr vam" src="statics/img/commons/cpu.png" title="cpu">&nbsp;Processus</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p id="cpu_onestaufond" class="wr txc vam">0%</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div id="cpu_onestaufond_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div>
                        </div>
                    </article>
                    <article>
                        <h2><img class="wr vam" src="statics/img/commons/memory.png" title="memoire">&nbsp;Mémoire</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p id="mem_onestaufond" class="wr txc vam">0%</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div  id="mem_onestaufond_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div></div>
                    </article>
                    <article>
                        <h2><img class="wr mw32 vam" src="statics/img/logo.png" title="utilisateur">&nbsp;Utilisateurs +</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p id="user_onestaufond" class="wr txc vam">0/500</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div id="user_onestaufond_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div>
                        </div>
                        <div id="user_onestaufond_list" class="wr mrgt5 r80 wp70 bd-bd3 cl-bd5 txc sm-dbr">
                        </div>
                    </article>
                    <br>
                </div>
            </div>
        </section>

        <section class="wr lg-c80 mrgt10 bg-bl2">
            <h1 class="wr pad9 bg-bd6 cl-bl5 dib1">
                <div class="wr w70 sm-f12">
                    <img class="wr vam" src="statics/img/commons/teamspeak3.png" title="teamspeak3">&nbsp;Teamspeak 3
                </div><!--
             --><p id="timer_teamspeak3" class="wr w30 txr sm-dn">00:00:00</p>
            </h1>
            <div class="wr dib1">
                <div class="wr w30 vam txc"><img id="status_teamspeak3" class="wr mh64" src="statics/img/commons/off.svg"></div><!--
             --><div class="wr w70 vam">
                    <br>
                    <article>
                        <h2><img class="wr vam" src="statics/img/commons/cpu.png" title="cpu">&nbsp;Processus</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p id="cpu_teamspeak3" class="wr txc vam">0%</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div id="cpu_teamspeak3_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div>
                        </div>
                    </article>
                    <article>
                        <h2><img class="wr vam" src="statics/img/commons/memory.png" title="memoire">&nbsp;Mémoire</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p id="mem_teamspeak3" class="wr txc vam">0%</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div  id="mem_teamspeak3_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div></div>
                    </article>
                    <article>
                        <h2><img class="wr mw32 vam" src="statics/img/logo.png" title="utilisateur">&nbsp;Utilisateurs +</h2>
                        <div class="wr dib1">
                            <div class="wr w20"><p id="user_teamspeak3" class="wr txc vam">0/32</p></div><!--
                         --><div class="wr w70 vam"><div class="wr db ht32 wp100 bg-vd3"><div id="user_teamspeak3_percent" class="wr db ht32 wp0 bg-rd1"></div></div></div>
                        </div>
                        <div id="user_teamspeak3_list" class="wr mrgt5 r80 wp70 bd-bd3 cl-bd5 txc sm-dbr">
                        </div>
                    </article>
                    <br>
                </div>
            </div>
        </section>

        <footer class="wr txc mrgt10 cl-bl5">
            <p>onestaufond.fr&nbsp;&copy;&nbsp;Gyn</p>
        </footer>

        <script>
        function updateStatus(url, status) { document.getElementById('status_' + url).src =  'statics/img/commons/' + status + '.svg'; }
        function updateUptime(url, uptime) {
            var sec_num = parseInt(uptime, 10);
            var hours   = Math.floor(sec_num / 3600);
            var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
            var seconds = sec_num - (hours * 3600) - (minutes * 60);
            if (hours   < 10) {hours   = "0"+hours;}
            if (minutes < 10) {minutes = "0"+minutes;}
            if (seconds < 10) {seconds = "0"+seconds;}
            document.getElementById('timer_' + url).innerHTML =  hours+':'+minutes+':'+seconds;
        }
        function updateCpu(url, percent) {
            document.getElementById('cpu_' + url).innerHTML =  percent + '%';
            document.getElementById('cpu_' + url + '_percent').style.width = percent + '%';
        }
        function updateMemory(url, percent) {
            document.getElementById('mem_' + url).innerHTML =  percent + '%';
            document.getElementById('mem_' + url + '_percent').style.width = percent + '%';
        }
        function updateUser(url, divider, number, list) {
            document.getElementById('user_' + url).innerHTML =  number + '/' + divider;
            document.getElementById('user_' + url + '_percent').style.width = Math.round(number/divider*100) + '%';
            for (var i = 0; i < list.length; i++) {
                var obj = list[i];
                var newel = document.createElement('span');
                newel.className = 'wr dib wp25';
                newel.innerHTML = obj;
                document.getElementById('user_' + url + '_list').appendChild(newel);
            }
        }
        function getStatusOld(url, divider=0) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    datas = this.responseText;
                    datas = JSON.parse(datas);
                    if (typeof datas.status != 'undefined') updateStatus(url, datas.status);
                    if (typeof datas.uptime != 'undefined') updateUptime(url, datas.uptime);
                    if (typeof datas.cpu != 'undefined') updateCpu(url, datas.cpu);
                    if (typeof datas.mem != 'undefined') updateMemory(url, datas.mem);
                    if (typeof datas.users != 'undefined') updateUser(url, divider, datas.users, datas.list);
                }
            };
            xhttp.open('GET', 'statics/' + url + '.json', true);
            xhttp.setRequestHeader('Content-Type', 'application/json');
            xhttp.overrideMimeType('application/json');
            xhttp.send();
        }
        getStatusOld('teamspeak3', 32);
        getStatusOld('server');





        function setUptime(url, uptime) {
            var sec_num = parseInt(uptime, 10);
            var hours   = Math.floor(sec_num / 3600);
            var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
            var seconds = sec_num - (hours * 3600) - (minutes * 60);
            if (hours   < 10) {hours   = "0"+hours;}
            if (minutes < 10) {minutes = "0"+minutes;}
            if (seconds < 10) {seconds = "0"+seconds;}
            document.getElementById('timer_' + url).innerHTML =  hours+':'+minutes+':'+seconds;
        }
        function setMemCpu(url, own, datas) {
            var percent = 0;
            for (var i = 0; i < datas.length; i++) {
                percent = (parseFloat(percent) + parseFloat(datas[i]));
            }
            percent = percent.toFixed(2);
            document.getElementById(own + '_' + url).innerHTML =  percent + '%';
            document.getElementById(own + '_' + url + '_percent').style.width = percent + '%';
        }
        function setUsers(url, divider, users) {
            var number = users.length;
            document.getElementById('user_' + url).innerHTML =  number + '/' + divider;
            document.getElementById('user_' + url + '_percent').style.width = Math.round(number/divider*100) + '%';
            for (var i = 0; i < number; i++) {
                var obj = users[i];
                var newel = document.createElement('span');
                newel.className = 'wr dib wp25';
                newel.innerHTML = obj;
                document.getElementById('user_' + url + '_list').appendChild(newel);
            }
        }
        function getStatus(url, divider=0) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    datas = this.responseText;
                    datas = JSON.parse(datas);
                    if (typeof datas.uptime != 'undefined') setUptime(url, datas.uptime);
                    if (typeof datas.cpu != 'undefined')    setMemCpu(url, 'cpu', datas.cpu);
                    if (typeof datas.mem != 'undefined')    setMemCpu(url, 'mem', datas.mem);
                    if (typeof datas.users != 'undefined')  setUsers(url, divider, datas.users);
                }
            };
            xhttp.open('GET', 'statics/' + url + '.json', true);
            xhttp.setRequestHeader('Content-Type', 'application/json');
            xhttp.overrideMimeType('application/json');
            xhttp.send();
        }
        getStatus('onestaufond', 500);
        </script>
    </body>
</html>
